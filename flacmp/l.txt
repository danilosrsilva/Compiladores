%{
#include <stdio.h>

class Node;

#include "flacmp.tab.h"
int yyerror(const char *s);

char *build_file_name;
int errorcount = 0;


%}

%option yylineno
%option noyywrap

%%

[ \t\r\n]               { }

"DIDI".*                { }

"+"                     { return '+'; }
"-"                     { return '-'; }
"*"                     { return '*'; } 
"/"                     { return '/'; }
"("                     { return '('; }
")"                     { return ')'; }
";"                     { return ';'; }
"="                     { return '='; }
"["					    { return '['; }
"]"					    { return ']'; }

">"				        { return TOK_MAQ; }
"<"				        { return TOK_MEQ; }
"=="				    { return TOK_EQL; }
"!="				    { return TOK_DDQ; }

"FLAPRINT"                  { return TOK_PRINT; }
"ZICO"                      { return TOK_WHILE; }
"GOL"                       { return TOK_IBLC; }
"MENGO"                     { return TOK_FBLC; }


[0-9]+ {
    yylval.integer = atoi(yytext);
    return TOK_INT;
}

[0-9]+\.[0-9]+ {
    yylval.flt = atof(yytext);
    return TOK_FLT;
}

\"[^\"]*\"  { 
    size_t len = yyleng - 2;                 
    yylval.name = (char*)malloc(len + 1);     
    strncpy(yylval.name, yytext + 1, len);      
    yylval.name[len] = '\0';                     
    return TOK_STR; 
}



[fF][lL][aA][a-zA-Z0-9_]* {
    yylval.name = strndup(yytext, yyleng);
    return TOK_IDENT;
}

.                       { printf("Caractere não presente no alfabeto %c\n", yytext[0] ); }

%%

int yyerror(const char *s) {
    fprintf(stderr, "%d:%d: %s\n", yylineno, 0, s);
    printf("\n");
        printf("__________████████_____██████\n");
        printf("_________█░░░░░░░░██_██░░░░░░█\n");
        printf("________█░░░░░░░░░░░█░░░░░░░░░█\n");
        printf("_______█░░░░░░░███░░░█░░░░░░░░░█\n");
        printf("_______█░░░░███░░░███░█░░░████░█\n");
        printf("______█░░░██░░░░░░░░███░██░░░░██\n");
        printf("_____█░░░░░░░░░░░░░░░░░█░░░░░░░░███\n");
        printf("____█░░░░░░░░░░░░░██████░░░░░████░░█\n");
        printf("____█░░░░░░░░░█████░░░████░░██░░██░░█\n");
        printf("___██░░░░░░░███░░░░░░░░░░█░░░░░░░░███\n");
        printf("__█░░░░░░░░░░░░░░█████████░░█████████\n");
        printf("_█░░░░░░░░░░█████_████___████_█████___█\n");
        printf("_█░░░░░░░░░░█______█_███__█_____███_█___█\n");
        printf("█░░░░░░░░░░░░█___████_████____██_██████\n");
        printf("░░░░░░░░░░░░░█████████░░░████████░░░█\n");
        printf("░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█\n");
        printf("░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██\n");
        printf("░░░░░░░░░░░░░░░░░░██░░░░░░░███████\n");
        printf("░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█\n");
        printf("░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█\n");
        printf("░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█\n");
        printf("░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█\n");
        printf("░░░░░░░░░░░█████████░░░░░░░░░░░░░░██\n");
        printf("░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█\n");
        printf("░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█\n");
        printf("░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████████\n");
        printf("░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█\n");
        printf("░░░░░░░░░░░░░░░░░░██████████████████\n");
        printf("░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█\n");
        printf("██░░░░░░░░░░░░░░░░░░░░░░░░░░░██\n");
        printf("▓██░░░░░░░░░░░░░░░░░░░░░░░░██\n");
        printf("▓▓▓███░░░░░░░░░░░░░░░░░░░░█\n");
        printf("▓▓▓▓▓▓███░░░░░░░░░░░░░░░██\n");
        printf("▓▓▓▓▓▓▓▓▓███████████████▓▓█\n");
        printf("▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██\n");
        printf("▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█\n");
        printf("▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓\n");
    errorcount++;
    return 1;
}

int yywrap() {
    return 1;
}



int main(int argc, char *argv[]) {

    if (argc <= 1) {
        fprintf(stderr, "Sintaxe: %s nome_do_programa\n", argv[0]);
        return 1;
    }

    build_file_name = argv[1];
    yyin = fopen(build_file_name, "r");
    if (yyin == NULL) {
        fprintf(stderr, "Não foi possível abrir o arquivo %s.\n", build_file_name);
        return 1;
    }

    //yydebug = 1;
    yyparse();

    if (yyin)
        fclose(yyin);
    
    return errorcount;
}

